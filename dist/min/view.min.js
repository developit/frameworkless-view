!function(a){"function"==typeof define&&define.amd?define(["util","events","zepto","handlebars"],a):a(window.util,window.EventEmitter,$,handlebars)}(function(a,b,c,d){function e(a,b,c,d){return a&&b&&c&&d?(a._eventRegistry||(a._eventRegistry=[]),a._eventTypes||(a._eventTypes={}),a._eventTypes.hasOwnProperty(b)||(a.addEventListener(b,f),a._eventTypes[b]=!0),a._eventRegistry.push({type:b,selector:c,callback:d}),!0):!1}function f(a){var b,c,d,e=this._eventRegistry.filter(function(b){return b.type===a.type?!0:!1});d=a.target||a.srcElement;do for(b=e.length;b--;)if(c=e[b],j.call(d,c.selector)&&c.callback.call(d,a)===!1)return!1;while((d=d.parentNode)!==this.parentNode)}function g(a,b){return this instanceof g?(this.rawView=a,this.renderTemplate=d.compile(this.rawView),this.base=document.createElement("div"),b&&this.base.setAttribute("id",b+"-base"),this.base.className="view-base",this.base.innerHTML=this.rawView,this.name=b,void(this.name&&this.base.setAttribute("data-view",b))):new g(a,b)}var h=b.EventEmitter||b;a=a||c;var i=Element.prototype,j=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.oMatchesSelector||function(a){for(var b=document.querySelectorAll(a),c=b.length;c--;)if(b[c]===this)return!0;return!1};return a.inherits(g,h),a.extend(g.prototype,{template:function(a){return this.renderTemplate?(this.templateData=a,this.base.innerHTML=a&&this.renderTemplate(a)||this.rawView,this):!1},hookEvents:function(a){var b,c,d,f;if(this.base){this.events=a;for(f in a)if(a.hasOwnProperty(f)&&(b=f.split(" "),c=b[0],d=b.slice(1).join(" "),!e(this.base,c,d,a[f])))throw new Error("Invalid events object.");return this}return!1},insertInto:function(a){if(!this.base)throw new Error("Cannot insert view prior to initialization");return"string"==typeof a&&(a=document.querySelector(a)),a.appendChild(this.base),this},insertAfter:function(a){return this.base&&("string"==typeof a&&(a=document.querySelector(a)),a.parentNode.insertBefore(this.base,a.nextSibling)),this}}),g.View=g.view=g,g});